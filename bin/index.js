(()=>{"use strict";var e={295:(e,t,r)=>{const n=require("events");var s=r.n(n);const i=require("readline"),a=r.n(i)().createInterface({input:process.stdin,output:process.stdout}),u=function(e,t=!0){return new Promise((async(t,r)=>{try{a.question(e,(async function(e){t(e)}))}catch(e){r(e)}}))},l={STDIN_SOURCE:1,FILTER:2,FIXED_EVENT_WINDOW:3,FOLD_SUM:4,FOLD_MEDIAN:5,FILE_SINK:6},o=l;class c extends(s()){constructor(){super()}async buildSteps(e=0,t=[]){let r="",n=Object.keys(o).length;r=0===e?"Construct your pipeline by choosing from the list of operations below:\n":"",Object.keys(o).map((e=>{r+=`${o[e]}. ${e}\n`})),r+=`${n+1}. Finish and run\n`;let s=await u(r);if((isNaN(s)||Number(s)<1||Number(s)>n+1)&&this.buildSteps(e,t),s===""+(n+1))return this.emit("pipelineInitFinish",t);s=Number(s);let i=null;var a;((a=s)===l.FIXED_EVENT_WINDOW||a===l.FILTER)&&(i=await this.getExtraValue(s)),t.push({type:s,value:i,index:e}),this.buildSteps(e+1,t)}getExtraValue(e){return new Promise((async(t,r)=>{try{const r=await u((e=>{switch(e){case l.FILTER:return"Please enter predicate using an x variable.\n";case l.FIXED_EVENT_WINDOW:return"Please enter event window length\n";default:return""}})(e));return((e,t)=>{switch(e){case l.FILTER:return!0;case l.FIXED_EVENT_WINDOW:return!isNaN(t);default:return""}})(e,r)||(console.log("Invalid value. please try again."),this.getExtraValue(e)),t(((e,t)=>{switch(e){case l.FILTER:return new Function("x",`return ${t}`);case l.FIXED_EVENT_WINDOW:return Number(t);default:return""}})(e,r))}catch(e){return r(e)}}))}}const h=c,p=(e,t)=>e>t?1:e<t?-1:0;!function(){const e=new h;e.on("pipelineInitFinish",(e=>{new class{constructor(e){this._steps=e,this._arrays=[]}async run(){this.initArrays.call(this),this.runSingleStep(0,0)}runSingleStep(e,t){t>=this._steps.length&&(t=0);const r=this._steps[t].type;switch(0===t&&r!==o.STDIN_SOURCE&&process.exit(),r){case o.STDIN_SOURCE:return this.stdinSrc(t);case o.FILTER:return this.filter(e,t,this._steps[t].value);case o.FIXED_EVENT_WINDOW:return this.fixedWindow(e,t);case o.FILE_SINK:return this.fileSink(e,t)}}printSteps(){console.log(this._steps)}onStepFinished({value:e,index:t}){this.runSingleStep(e,t+1)}onFixedWindowReached({arrIndex:e,index:t}){switch((t+=1)>=this._steps.length&&(t=0),this._steps[t].type){case o.FOLD_SUM:let r=this._arrays[e].array.reduce(((e,t)=>e+t),0);return this.runSingleStep(r,t+1);case o.FOLD_MEDIAN:const n=this._arrays[e].maxLength,s=Math.ceil(n/2),i=n%2==0?(this._arrays[e].array[s]+this._arrays[e].array[s-1])/2:this._arrays[e].array[s-1];return this.runSingleStep(i,t+1);default:return this.runSingleStep(0,t+1)}}initArrays(){this._steps.map((e=>{e.type===o.FIXED_EVENT_WINDOW&&this._arrays.push({array:[],maxLength:e.value,index:e.index})}))}async stdinSrc(e){const t=await u("");isNaN(t)&&this.stdinSrc(),console.log(`>${t}\n`),this.onStepFinished({value:Number(t),index:e})}filter(e,t,r){return r(e)?this.runSingleStep(e,t+1):this.runSingleStep(0,0)}fixedWindow(e,t){for(let r=0;r<this._arrays.length;r++){let n=this._arrays[r];if(n.array.length===n.maxLength&&t<=n.index)n.array=[];else if(n.array.length===n.maxLength)continue;return n.array.push(e),n.array.sort(p),n.array.length===n.maxLength?this.onFixedWindowReached({arrIndex:r,index:t}):this.runSingleStep(0,0)}}fileSink(e,t){return console.log(`${e}\n`),this.runSingleStep(e,t+1)}getInput(){return new Promise(((e,t)=>{try{const t=u("");if(isNaN(t))return this.getInput();e(Number(t))}catch(e){t(e)}}))}}(e).run()})),e.buildSteps()}()},294:e=>{e.exports=require("babel-polyfill")}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r(294),r(295)})();